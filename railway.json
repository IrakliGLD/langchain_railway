{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "runtime": "V2",
    "numReplicas": 1,
    "startCommand": "/bin/sh -c 'echo Starting EnerBot on PORT=$PORT && sleep 15 && uvicorn main:app --host 0.0.0.0 --port $PORT --workers 1 --log-level debug > /tmp/app.log 2>&1'",
    "healthcheckPath": "/healthz",
    "healthcheckTimeout": 400,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10,
    "sleepApplication": false,
    "useLegacyStacker": false,
    "multiRegionConfig": {
      "europe-west4-drams3a": {
        "numReplicas": 1
      }
    },
    "variables": {
      "PORT": "${{PORT}}",
      "SUPABASE_DB_URL": "${{SUPABASE_DB_URL}}",
      "APP_SECRET_KEY": "${{APP_SECRET_KEY}}",
      "OPENAI_API_KEY": "${{OPENAI_API_KEY}}",
      "GOOGLE_API_KEY": "${{GOOGLE_API_KEY}}",
      "MODEL_TYPE": "${{MODEL_TYPE:-gemini}}",
      "GEMINI_MODEL": "${{GEMINI_MODEL:-gemini-1.5-flash-latest}}"
    },
    "preDeployCommand": "python -c 'import os; assert os.getenv(\"SUPABASE_DB_URL\") and os.getenv(\"APP_SECRET_KEY\") and (os.getenv(\"OPENAI_API_KEY\") or os.getenv(\"GOOGLE_API_KEY\"))'"
  }
}
